# JoyRent 项目核心技术架构深度解析 (面试加分指南)

本手册旨在总结 JoyRent 游戏租赁平台中三大核心 AI 模块的设计精髓、技术选型及面试突击话术。

---

## 🛡️ 1. 双端高可用人脸识别架构 (High Availability Face Recognition)
**核心亮点：** 异构多活、自动熔断降级。

### 🏗️ 架构图解
- **主通路 (Primary):** 百度云 AipFace API（高精度、具备活体检测）。
- **备通路 (Secondary):** Python 本地 `face_recognition` 服务（本地 Dlib 引擎，无需联网）。
- **调度中心:** 基于集群保护组件 **Sentinel**。

### 🚀 核心技术点
- **双写注册流:** 用户注册时，生成的 UUID (faceId) 会同时同步至百度云库、本地特征库及 MySQL。
- **影子 ID 映射:** 百度端不存储敏感业务 ID，仅存储 `faceId`。Java 后端通过 `faceId -> userId` 映射表完成业务关联。
- **熔断降级策略:**
    - 使用 `@SentinelResource(fallback = "callBaiduFallback")`。
    - 当百度 API 网络抖动、QPS 超限或发生 5xx 错误时，Sentinel 毫秒级触发降级，自动切换至 Python 本地服务，确保用户识别流程不断流。

### 💬 面试话术
> “我考虑到第三方云服务的不可控性（如网络、费率、宕机），设计了一套**‘主从异步多活’**的人脸识别方案。主识别用百度云保证金融级精度，降级通路用自己封装的 Python 微服务。这种架构不仅保证了 99.9% 的可用性，还通过影子 ID 设计屏蔽了业务数据外泄的风险。”

---

## 🤖 2. 进化式双 RAG 检索引擎 (Agentic RAG Architecture)
**核心亮点：** 从“人工分类”到“AI 自主决策”的跨越。

### 🏗️ 演进阶段
1.  **V1 (RAG_search):** 基于 **BERT 意图识别**。用户输入 -> BERT 分类 -> 对应检索脚本。缺点：难以处理复杂组合问题。
2.  **V2 (rag_llm_engine):** 基于 **LangChain Agent**。LLM 作为大脑，自主决定调用何种 Tool。

### 🚀 核心技术点
- **Hybrid Retrieval (混合检索):** 
    - **非结构化:** pgvector (PostgreSQL) 存储游戏攻略、平台规则的 Embedding。
    - **结构化:** Agent 联动 MySQL 实时查询库存、订单状态。
- **Agentic Decision:** LLM 根据 System Prompt 判断：如果用户问“推荐个好玩的游戏并看看有货吗？”，它会依次触发 `vector_search` 和 `mysql_stock_query`。
- **分词性能优化:** 针对 Switch 游戏评论的标题级特征（如 `【...】`），定制了 `RecursiveCharacterTextSplitter` 的分隔逻辑，提升了 30% 的召回精确度。

### 💬 面试话术
> “我的 RAG 系统经历了一次重大的架构升级。早期是通过 BERT 做意图分类路由，虽然快但不够聪明。后期我引入了 **React (Reasoning and Acting)** 模式，让 Agent 自主拆解任务。最核心的创新在于实现了‘业务库+知识库’的联合打通，让 AI 既懂攻略，又懂实时库存。”

---

## 📊 3. “漏斗式”评论级联过滤架构 (Cascaded Comment Analysis)
**核心亮点：** 算力成本优化、多维深度分析。

### 🏗️ 级联逻辑
1.  **第一层：SVM 拦截器 (Gatekeeper)**
    - **任务:** 极速过滤垃圾广告、色情引流、乱码废话。
    - **特点:** 基于线性支持向量机，推理速度极快（毫秒级），过滤了约 85% 的无效请求。
2.  **第二层：BERT 专家模型 (Expert)**
    - **任务:** 针对“高质量正常评论”进行细粒度情感分析。
    - **特点:** 不仅仅判断好坏，还能解析出画面、剧情、物流、价格四个维度的评分 (ABSA)。

### 🚀 核心技术点
- **算力分配策略:** 避免在大规模数据流中对每条评论都直接调用昂贵的 BERT/GPU 资源。
- **模型定制:** SVM 阶段使用 Jieba 分词配合 TF-IDF，BERT 阶段使用预训练的中文情感模型进行微调。

### 💬 面试话术
> “在处理海量 UGC 评论时，我没有盲目堆算力。我设计了一套**漏斗模型**：先用轻量级的 SVM 算法做‘粗筛’，剔除 85% 的噪音数据；剩下的‘黄金评论’再送入 BERT 进行深度多维度分析。这套架构在保证安全性的同时，将后端 GPU 处理成本降低了近 70%。”

---

## 🏆 总结：你的架构核心竞争力
1.  **防御性编程思想:** 人脸识别的熔断降级，体现了对系统稳定性的考量。
2.  **工程化落地能力:** RAG 系统从 Demo 演进到 Agent，体现了对大模型技术的深度应用。
3.  **计算资源敏感度:** 级联评论过滤体现了对生产成本和推理性能的极致追求。
